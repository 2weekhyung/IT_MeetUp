<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <!-- mybatis 환경 설정 파일 활용 -->
 <mapper namespace="com.itmeetup.mybatis.ICompleteProjectDAO">
 
	<select id="cpList" resultType="com.itmeetup.mybatis.CompleteProjectDTO">
	    SELECT RNUM, TITLE, CONTENT, TEAMNAME, CATCODE, CATNAME, CPCODE
		FROM
		(SELECT ROW_NUMBER() OVER(ORDER BY FINAL_DATE DESC) AS RNUM, F.FINAL_NAME AS TITLE, F.FINAL_INTRO AS CONTENT, O.OP_TEAM_NAME AS TEAMNAME, O.OP_CAT_CODE AS CATCODE, C.CAT_NAME AS CATNAME, O.OP_CODE AS CPCODE
		FROM FINAL_INFO F JOIN OPEN_PROJECT O
                  ON F.FI_OP_CODE = O.OP_CODE
                    JOIN CATEGORY C
                    ON O.OP_CAT_CODE = C.CAT_CODE
	    <if test="category != null and category != ''">
	    WHERE O.OP_CAT_CODE = #{category}
	    </if>
	    )
	    WHERE RNUM >= #{start} AND #{end} >= RNUM
	</select>
 	<select id="getDataCount" resultType="java.lang.Integer">
 		SELECT COUNT(*) AS COUNT
		FROM FINAL_INFO F JOIN OPEN_PROJECT O
                  ON F.FI_OP_CODE = O.OP_CODE
        <if test="category != null and category != ''">
	    AND O.OP_CAT_CODE = #{category}
	    </if>
 	</select>
 	<select id="catList" resultType="com.itmeetup.mybatis.CategoryDTO">
		SELECT CAT_CODE AS CATCODE, CAT_NAME AS CATNAME
		FROM CATEGORY
 	</select>
 	<!-- 완료 프로젝트 상세 페이지 -->
 	<select id="completeProjectDetail" resultType="com.itmeetup.mybatis.CompleteProjectDTO">
		SELECT F.FINAL_NAME AS TITLE, F.FINAL_INTRO AS CONTENT, F.FINAL_IMG_1 AS IMG1, F.FINAL_IMG_2 AS IMG2, F.FINAL_IMG_3 IMG3, O.OP_TEAM_NAME AS TEAMNAME
		FROM FINAL_INFO F JOIN OPEN_PROJECT O
                  ON F.FI_OP_CODE = O.OP_CODE
		WHERE F.FI_OP_CODE = #{cpCode}
 	</select>
	<select id="completeProjectSkill" resultType="com.itmeetup.mybatis.SkillDTO">
		SELECT DISTINCT AT.AT_SK_CODE "SKCODE", S.SK_NAME "SKNAME"
		FROM SKILL S JOIN ACTUAL_TECH AT
		             ON S.SK_CODE = AT.AT_SK_CODE
		                    JOIN REPORT R
		                    ON AT.AT_REP_NO = R.REP_NO
		                        JOIN ASSIGNMENT A
		                        ON R.REP_ASS_CODE = A.ASS_CODE
		                            JOIN PART_CHECK P
		                            ON A.INDICATOR = P.PC_CODE
		                                JOIN PART_APPLICANT PA
		                                ON P.PC_PA_NO = PA.PA_NO
		                                    JOIN TEAM_JOB T
		                                    ON PA.PA_TJ_NO = T.TJ_NO
		WHERE T.TJ_OP_CODE = #{cpCode}
	</select>
 	
 </mapper>