<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <!-- mybatis 환경 설정 파일 활용 -->
 <mapper namespace="com.itmeetup.mybatis.IGroupHomeDAO">
 	
 	<!-- 그룹홈에 보여질 주간업무보고리스트 출력 -->
	<select id="weeklyReportList" resultType="com.itmeetup.mybatis.WeeklyReportDTO">
		SELECT ROWNUM "WRNUMBER", WR_TITLE "WRTITLE", WR_CONTENT "WRCONTENT", TO_CHAR(WR_DATE, 'YYYY-MM-DD') "WRDATE", PI_NICKNAME "WRPERSON"
		FROM WEEKLYREPVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND ROWNUM  &lt;= 4
 	</select>
 	
 	<!-- 프로젝트마다 나온 산출물 갯수 -->
 	<!-- 분석단계 회의록 -->
 	<select id="meetAnalCount" resultType="java.lang.Integer">
	 	SELECT COUNT(*) AS "MEETANALCOUNT"
		FROM GROUPOUTPUTVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND ASS_OU_CODE = 'OU_1'
	</select>
	<!-- 설계단계 회의록 -->
	<select id="meetDesignCount" resultType="java.lang.Integer">
	 	SELECT COUNT(*) AS "MEETDESIGNCOUNT"
		FROM GROUPOUTPUTVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND ASS_OU_CODE = 'OU_2'
	</select>
	<!-- 구현단계 회의록 -->
	<select id="meetAvatarCount" resultType="java.lang.Integer">
	 	SELECT COUNT(*) AS "MEETAVARTARCOUNT"
		FROM GROUPOUTPUTVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND ASS_OU_CODE = 'OU_3'
	</select>
	<!-- 테스트단계 회의록 -->
	<select id="meetTestCount" resultType="java.lang.Integer">
	 	SELECT COUNT(*) AS "MEETTESTCOUNT"
		FROM GROUPOUTPUTVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND ASS_OU_CODE = 'OU_4'
	</select>
	<!-- 회의록 총 갯수 -->
	<select id="meetTotalCount" resultType="java.lang.Integer">
		SELECT SUM(COUNT(*)) AS "MEETCOUNT"
		FROM GROUPOUTPUTVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND ASS_OU_CODE IN ('OU_1', 'OU_2', 'OU_3', 'OU_4') AND ASS_OU_CODE IS NOT NULL
		GROUP BY ASS_OU_CODE
	</select>
	<select id="planCount" resultType="java.lang.Integer">
		SELECT COUNT(*) AS "PLANCOUNT"
		FROM GROUPOUTPUTVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND ASS_OU_CODE = 'OU_1'
	</select>
	<select id="requestCount" resultType="java.lang.Integer">
		SELECT COUNT(*) AS "REQUESTCOUNT"
		FROM GROUPOUTPUTVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND ASS_OU_CODE = 'OU_2'
	</select>
	<select id="flowchartCount" resultType="java.lang.Integer">
		SELECT COUNT(*) AS "FLOWCHARTCOUNT"
		FROM GROUPOUTPUTVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND ASS_OU_CODE = 'OU_3'	
	</select>
	
	<!-- 맡은 직무마다 보여지는 닉네임 출력 -->
	<select id="groupHomePlan" resultType="com.itmeetup.mybatis.GroupDTO">
		SELECT PI_NICKNAME "PINICKNAME"
		FROM GROUPSETVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND JOB_CODE = 'JOB_1'
 	</select>
 	<select id="groupHomeDesign" resultType="com.itmeetup.mybatis.GroupDTO">
		SELECT PI_NICKNAME "PINICKNAME"
		FROM GROUPSETVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND JOB_CODE = 'JOB_2'
 	</select>
 	<select id="groupHomeFront" resultType="com.itmeetup.mybatis.GroupDTO">
		SELECT PI_NICKNAME "PINICKNAME"
		FROM GROUPSETVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND JOB_CODE = 'JOB_3'
 	</select>
 	<select id="groupHomeBack" resultType="com.itmeetup.mybatis.GroupDTO">
		SELECT PI_NICKNAME "PINICKNAME"
		FROM GROUPSETVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND JOB_CODE = 'JOB_4'
 	</select>
 	
 	<!-- 프로젝트 진행기간 -->
 	<select id="progressPeriod" resultType="com.itmeetup.mybatis.OpenProjectDTO">
		SELECT "START", END "END"
		FROM PROJECT_INFO
		WHERE CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode })
 	</select>
 	
 	<!-- 일정단계별 진행기간 비율 -->
 	<select id="analyzePercent" resultType="java.lang.Double">
		SELECT ROUND((ADJUSTED_DATE/DAY_OP)*100,1) AS "PERCENT"
		FROM GROUPPERIODVIEW
		WHERE CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND SD_SS_CODE = 'SS_1'
 	</select>
 	<select id="designPercent" resultType="java.lang.Double">
		SELECT ROUND((ADJUSTED_DATE/DAY_OP)*100,1) AS "PERCENT"
		FROM GROUPPERIODVIEW
		WHERE CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND SD_SS_CODE = 'SS_2'
 	</select>
 	<select id="avatarPercent" resultType="java.lang.Double">
		SELECT ROUND((ADJUSTED_DATE/DAY_OP)*100,1) AS "PERCENT"
		FROM GROUPPERIODVIEW
		WHERE CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND SD_SS_CODE = 'SS_3'
 	</select>
 	<select id="testPercent" resultType="java.lang.Double">
		SELECT ROUND((ADJUSTED_DATE/DAY_OP)*100,1) AS "PERCENT"
		FROM GROUPPERIODVIEW
		WHERE CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND SD_SS_CODE = 'SS_4'
 	</select>
 	
 	<!-- 팀장 평가명 목록 -->
 	<select id="leaderEval" resultType="com.itmeetup.mybatis.EvaluationDTO">
		SELECT QUE_NAME "QUENAME"
		FROM EVALNAMEVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND QI_CODE = 'QI_2'
 	</select>
 	
 	<!-- 팀원 평가명 목록  -->
 	<select id="teamEval" resultType="com.itmeetup.mybatis.EvaluationDTO">
		SELECT QUE_NAME "QUENAME"
		FROM EVALNAMEVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode }) AND QI_CODE = 'QI_1'
 	</select>
 	
 	<!-- 평가에 쓰일 그룹원 리스트 -->
 	<select id="groupPersonnel" resultType="com.itmeetup.mybatis.GroupDTO">
		SELECT PC_CODE "PCCODE", PI_NICKNAME "PINICKNAME"
		FROM GROUPSETVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM OPEN_PROJECT
		WHERE OP_MEM_CODE = #{memCode })
 	</select>
 	
	 	
 </mapper>