<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <!-- mybatis 환경 설정 파일 활용 -->
 <mapper namespace="com.itmeetup.mybatis.IGroupSetupDAO">
 
 	<!-- 그룹원 설정에 보여질 그룹원 정보 출력 -->
 	<select id="groupSetupList" resultType="com.itmeetup.mybatis.GroupDTO">
		SELECT ROWNUM "OPCODE", PI_NICKNAME "PINICKNAME", JOB_NAME "JOBNAME", CHARGERCOUNT "REPGRANT", COMPLETEDCOUNT "REPSUCCESS", LEAPCCODE "LEAPCCODE"
		FROM GROUPSETUPVIEW
		WHERE OP_CODE = (SELECT OP_CODE
		FROM PERSONAL_INFO PI
        LEFT JOIN MEMBER M ON PI.PI_MEM_CODE = M.MEM_CODE
        LEFT JOIN PART_APPLICANT PA ON M.MEM_CODE = PA.PA_MEM_CODE
        LEFT JOIN PART_CHECK PC ON PA.PA_NO = PC.PC_PA_NO
        LEFT JOIN TEAM_JOB JV ON PA.PA_TJ_NO = JV.TJ_NO
        LEFT JOIN OPEN_PROJECT OP ON JV.TJ_OP_CODE = OP.OP_CODE
		WHERE PA_MEM_CODE = #{memCode }
        AND OP_END_DATE > SYSDATE)
		
		
 	</select>
 	
 	<!-- 프로젝트 그룹명 출력 -->
 	<select id="groupTeamName" resultType="com.itmeetup.mybatis.OpenProjectDTO">
		SELECT OP_CODE "OPCODE", OP_TEAM_NAME "TEAMNAME"
		FROM MEMBER M
		LEFT JOIN OPEN_PROJECT OP ON M.MEM_CODE = OP.OP_MEM_CODE
		WHERE OP_CODE = (SELECT OP_CODE
		FROM PERSONAL_INFO PI
        LEFT JOIN MEMBER M ON PI.PI_MEM_CODE = M.MEM_CODE
        LEFT JOIN PART_APPLICANT PA ON M.MEM_CODE = PA.PA_MEM_CODE
        LEFT JOIN PART_CHECK PC ON PA.PA_NO = PC.PC_PA_NO
        LEFT JOIN TEAM_JOB JV ON PA.PA_TJ_NO = JV.TJ_NO
        LEFT JOIN OPEN_PROJECT OP ON JV.TJ_OP_CODE = OP.OP_CODE
		WHERE PA_MEM_CODE = #{memCode }
        AND OP_END_DATE > SYSDATE)
 	</select>
 	
 	<!-- 그룹명 수정을 위한 코드찾기 쿼리문 -->
 	<select id="GroupTeamNamesearchId" resultType="com.itmeetup.mybatis.OpenProjectDTO">
		SELECT OP_CODE "opCODE", OP_TEAM_NAME "TEAMNAME"
		FROM OPEN_PROJECT OP
		LEFT JOIN MEMBER M ON M.MEM_CODE = OP.OP_MEM_CODE
		WHERE OP_CODE = (SELECT OP_CODE
		FROM PERSONAL_INFO PI
        LEFT JOIN MEMBER M ON PI.PI_MEM_CODE = M.MEM_CODE
        LEFT JOIN PART_APPLICANT PA ON M.MEM_CODE = PA.PA_MEM_CODE
        LEFT JOIN PART_CHECK PC ON PA.PA_NO = PC.PC_PA_NO
        LEFT JOIN TEAM_JOB JV ON PA.PA_TJ_NO = JV.TJ_NO
        LEFT JOIN OPEN_PROJECT OP ON JV.TJ_OP_CODE = OP.OP_CODE
		WHERE PA_MEM_CODE = #{memCode }
        AND OP_END_DATE > SYSDATE)
 	</select>
 	
 	<!-- 그룹명 수정 -->
 	<update id="groupTeamNamemodify">
		UPDATE OPEN_PROJECT
		SET OP_TEAM_NAME= #{teamName}
		WHERE OP_CODE = (SELECT OP_CODE
		FROM PERSONAL_INFO PI
        LEFT JOIN MEMBER M ON PI.PI_MEM_CODE = M.MEM_CODE
        LEFT JOIN PART_APPLICANT PA ON M.MEM_CODE = PA.PA_MEM_CODE
        LEFT JOIN PART_CHECK PC ON PA.PA_NO = PC.PC_PA_NO
        LEFT JOIN TEAM_JOB JV ON PA.PA_TJ_NO = JV.TJ_NO
        LEFT JOIN OPEN_PROJECT OP ON JV.TJ_OP_CODE = OP.OP_CODE
		WHERE PA_MEM_CODE = #{memCode }
        AND OP_END_DATE > SYSDATE)
	</update>
 	
 </mapper>